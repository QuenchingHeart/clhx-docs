# 2.5 接口模块

以组为单位包含了服务器程序为客户端提供的所有接口 \(即 API\)。

## 2.5.1 用户 API 组

### 2.5.1.1 用户登录 API

{% api-method method="post" host="https://api.smartcommunity.mrdrivingduck.cn" path="/login" %}
{% api-method-summary %}
用户登录接口
{% endapi-method-summary %}

{% api-method-description %}
根据客户端提供的 JSON code，向微信后台获取微信用户的 Open ID 与头像 URL，并保存到数据库中。如果数据库中已经包含了这个 Open ID，则说明用户已存在，登录成功；如果数据库中没有这个 Open ID，说明用户第一次进入应用，将用户的所有数据保存到数据库中后，登录成功。  
登录成功后，服务器程序将生成 token 返回客户端。客户端的后续动作需要在请求头中加入 token 作为认证信息。
{% endapi-method-description %}

{% api-method-spec %}
{% api-method-request %}
{% api-method-body-parameters %}
{% api-method-parameter name="avatarUrl" type="string" required=true %}
微信用户的头像 URL
{% endapi-method-parameter %}

{% api-method-parameter name="nickName" type="string" required=true %}
微信用户昵称
{% endapi-method-parameter %}

{% api-method-parameter name="jsonCode" type="string" required=true %}
微信客户端提供的 JSON code
{% endapi-method-parameter %}
{% endapi-method-body-parameters %}
{% endapi-method-request %}

{% api-method-response %}
{% api-method-response-example httpCode=200 %}
{% api-method-response-example-description %}
登录成功，向客户端返回 token 和用户 ID
{% endapi-method-response-example-description %}

```
{
  "token": "string",
  "userID": 0
}
```
{% endapi-method-response-example %}

{% api-method-response-example httpCode=401 %}
{% api-method-response-example-description %}
微信未对该用户授权，JSON code 不合法
{% endapi-method-response-example-description %}

```

```
{% endapi-method-response-example %}

{% api-method-response-example httpCode=500 %}
{% api-method-response-example-description %}
服务器内部错误
{% endapi-method-response-example-description %}

```

```
{% endapi-method-response-example %}
{% endapi-method-response %}
{% endapi-method-spec %}
{% endapi-method %}

### 2.5.1.2 用户昵称更新 API

{% api-method method="put" host="https://api.smartcommunity.mrdrivingduck.cn" path="/user/nickname" %}
{% api-method-summary %}
更新用户昵称
{% endapi-method-summary %}

{% api-method-description %}
用户在注册后默认使用微信昵称。通过调用该接口，用户可以修改自己在小程序中的昵称。
{% endapi-method-description %}

{% api-method-spec %}
{% api-method-request %}
{% api-method-headers %}
{% api-method-parameter name="Authorization" type="string" required=true %}
Token
{% endapi-method-parameter %}
{% endapi-method-headers %}

{% api-method-query-parameters %}
{% api-method-parameter name="userID" type="integer" required=true %}
用户 ID
{% endapi-method-parameter %}

{% api-method-parameter name="nickname" type="string" required=true %}
修改后的用户昵称
{% endapi-method-parameter %}
{% endapi-method-query-parameters %}
{% endapi-method-request %}

{% api-method-response %}
{% api-method-response-example httpCode=200 %}
{% api-method-response-example-description %}

{% endapi-method-response-example-description %}

```
{
  "nickname": "string",
  "userID": 0
}
```
{% endapi-method-response-example %}
{% endapi-method-response %}
{% endapi-method-spec %}
{% endapi-method %}

## 2.5.2 状态 API 组

### 2.5.2.1 状态检测 API

{% api-method method="get" host="https://api.smartcommunity.mrdrivingduck.cn" path="/status" %}
{% api-method-summary %}
接口状态检测
{% endapi-method-summary %}

{% api-method-description %}
 用于测试服务器的所有 API 接口是否处于正常运行状态
{% endapi-method-description %}

{% api-method-spec %}
{% api-method-request %}

{% api-method-response %}
{% api-method-response-example httpCode=200 %}
{% api-method-response-example-description %}

{% endapi-method-response-example-description %}

```
"API status: OK."
```
{% endapi-method-response-example %}
{% endapi-method-response %}
{% endapi-method-spec %}
{% endapi-method %}

